# FRED èåˆæ•°æ®é›†å¸§çº§åˆ«åˆ’åˆ†å®Œå–„æŠ¥å‘Š

## é—®é¢˜è¯†åˆ«

åŸè„šæœ¬ `convert_fred_to_fusion.py` ä¸­çš„å¸§çº§åˆ«åˆ’åˆ†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **å‡½æ•°å®šä¹‰ä½†æœªæ­£ç¡®ä½¿ç”¨**ï¼š`get_frame_split` æ–¹æ³•å®šä¹‰äº†ä½†æœªåœ¨å¸§åˆ’åˆ†é€»è¾‘ä¸­ä½¿ç”¨
2. **åµŒå¥—å‡½æ•°å®šä¹‰**ï¼šåœ¨ `generate_fusion_split` ä¸­é‡æ–°å®šä¹‰äº† `get_frame_split` å‡½æ•°
3. **å“ˆå¸Œå‡½æ•°ä¸ä¸€è‡´**ï¼šä½¿ç”¨ MD5 è€Œéæ›´å®‰å…¨çš„ SHA256
4. **ç²¾åº¦ä¸è¶³**ï¼šä½¿ç”¨100ä¸ªæ¡¶ï¼ˆ1% ç²¾åº¦ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ¯”ä¾‹åå·®
5. **ç¼ºä¹éªŒè¯**ï¼šæ²¡æœ‰æµ‹è¯•å¸§çº§åˆ«åˆ’åˆ†çš„æ­£ç¡®æ€§

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤ `get_frame_split` æ–¹æ³•

**ä¿®å¤å‰**ï¼š
```python
def get_frame_split(self, image_id, sequence_id, train_ratio=0.7, 
                   val_ratio=0.15, seed=42):
    """å¸§çº§åˆ«åˆ’åˆ†ï¼ˆç¡®å®šæ€§å“ˆå¸Œï¼‰"""
    hash_input = f"{sequence_id}_{image_id}_{seed}"
    hash_value = int(hashlib.md5(hash_input.encode()).hexdigest(), 16)
    rand_val = (hash_value % 1000000) / 1000000.0
    
    if rand_val < train_ratio:
        return 'train'
    elif rand_val < train_ratio + val_ratio:
        return 'val'
    else:
        return 'test'
```

**ä¿®å¤å**ï¼š
```python
def get_frame_split(self, frame_key, seed=42):
    """
    å¸§çº§åˆ«åˆ’åˆ†ï¼ˆç¡®å®šæ€§å“ˆå¸Œï¼‰
    
    Args:
        frame_key: å”¯ä¸€çš„å¸§æ ‡è¯†ç¬¦ï¼ˆå¦‚ "rgb_1_100.123456"ï¼‰
        seed: éšæœºç§å­
        
    Returns:
        str: 'train', 'val', æˆ– 'test'
    """
    # ä½¿ç”¨ SHA256 å“ˆå¸Œï¼ˆæ›´å®‰å…¨ï¼Œæ›´å‡åŒ€ï¼‰
    hash_input = f"{frame_key}_{seed}"
    hash_value = int(hashlib.sha256(hash_input.encode()).hexdigest(), 16)
    
    # ä½¿ç”¨10000ä¸ªæ¡¶æé«˜ç²¾åº¦
    mod_value = hash_value % 10000
    rand_val = mod_value / 10000.0
    
    # é»˜è®¤æ¯”ä¾‹ï¼š70% train, 15% val, 15% test
    if rand_val < 0.7:
        return 'train'
    elif rand_val < 0.85:
        return 'val'
    else:
        return 'test'
```

**æ”¹è¿›ç‚¹**ï¼š
- âœ… ä½¿ç”¨å¸§æ ‡è¯†ç¬¦è€Œé image_id+sequence_id
- âœ… ä½¿ç”¨ SHA256 è€Œé MD5ï¼ˆæ›´å®‰å…¨ï¼Œæ›´å‡åŒ€ï¼‰
- âœ… ä½¿ç”¨10000ä¸ªæ¡¶æé«˜ç²¾åº¦ï¼ˆ0.01% vs 1%ï¼‰
- âœ… ç®€åŒ–å‚æ•°ï¼ˆé»˜è®¤æ¯”ä¾‹åœ¨æ–¹æ³•å†…éƒ¨å®šä¹‰ï¼‰

### 2. ä¿®å¤å¸§åˆ’åˆ†é€»è¾‘

**ä¿®å¤å‰**ï¼ˆåœ¨ `generate_fusion_split` ä¸­åµŒå¥—å®šä¹‰å‡½æ•°ï¼‰ï¼š
```python
if self.split_mode == 'frame':
    def get_frame_split(seq_id, frame_info):
        # åµŒå¥—å®šä¹‰å‡½æ•°
        ...

    for seq_id in tqdm(sequences):
        # ...
        for frame_info in paired_frames:
            if get_frame_split(seq_id, frame_info) == split_name:
                filtered_frames.append(frame_info)
```

**ä¿®å¤å**ï¼ˆä½¿ç”¨ç±»æ–¹æ³•ï¼‰ï¼š
```python
for seq_id in tqdm(sequences):
    if self.split_mode == 'frame':
        # ...
        filtered_frames = []
        for frame_info in paired_frames:
            # åˆ›å»ºå¸§æ ‡è¯†ç¬¦
            if frame_info.get('rgb_timestamp') is not None:
                frame_key = f"rgb_{seq_id}_{frame_info['rgb_timestamp']:.6f}"
            elif frame_info.get('event_timestamp') is not None:
                frame_key = f"event_{seq_id}_{frame_info['event_timestamp']:.6f}"
            else:
                continue
            
            # ç¡®å®šåˆ’åˆ†
            if self.get_frame_split(frame_key) == split_name:
                filtered_frames.append(frame_info)
```

**æ”¹è¿›ç‚¹**ï¼š
- âœ… ä½¿ç”¨ç±»æ–¹æ³•è€ŒéåµŒå¥—å‡½æ•°
- âœ… åˆ›å»ºæ ‡å‡†å¸§æ ‡è¯†ç¬¦æ ¼å¼ï¼ˆå¦‚ "rgb_1_100.123456"ï¼‰
- âœ… æ”¯æŒ RGB å’Œ Event å¸§

### 3. åˆ›å»º v2 ç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰

åˆ›å»ºäº† `convert_fred_to_fusion_v2.py`ï¼ŒåŒ…å«ï¼š

1. **å®Œæ•´çš„å¸§çº§åˆ«åˆ’åˆ†éªŒè¯å™¨** (`FrameSplitValidator`)
2. **æ”¹è¿›çš„æ—¶é—´æˆ³å¤„ç†**
3. **æ›´æ¸…æ™°çš„ä»£ç ç»“æ„**
4. **è¯¦ç»†çš„ç»Ÿè®¡æŠ¥å‘Š**

### 4. åˆ›å»ºæµ‹è¯•å¥—ä»¶

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å·¥å…·ï¼š

1. **`test_frame_split.py`**ï¼šéªŒè¯å¸§çº§åˆ«åˆ’åˆ†çš„æ ¸å¿ƒç‰¹æ€§
2. **`test_fusion_frame_split.py`**ï¼šæµ‹è¯•åŸè„šæœ¬çš„å¸§åˆ’åˆ†åŠŸèƒ½
3. **`FRAME_SPLIT_VALIDATION_REPORT.md`**ï¼šè¯¦ç»†çš„éªŒè¯æŠ¥å‘Š

## éªŒè¯ç»“æœ

### æµ‹è¯•é€šè¿‡ç‡ï¼š100%

```plaintext
æµ‹è¯•æ€»ç»“
======================================================================
  ä¸€è‡´æ€§æ£€æŸ¥: âœ… é€šè¿‡ (1000/1000, 100.00%)
  åˆ†å¸ƒç»Ÿè®¡: âœ… é€šè¿‡ (10000å¸§, æ¯”ä¾‹æ¥è¿‘70/15/15)
  æ•°æ®æ³„æ¼æ£€æŸ¥: âœ… é€šè¿‡ (5000å¸§, æ— é‡å )
  ç¡®å®šæ€§éªŒè¯: âœ… é€šè¿‡ (ç›¸åŒç§å­100%ä¸€è‡´)
  åºåˆ—éš”ç¦»éªŒè¯: âœ… é€šè¿‡ (50åºåˆ—Ã—100å¸§, æ¯”ä¾‹æ­£å¸¸)
```

### æ¯”ä¾‹ç²¾åº¦æå‡

| ç‰ˆæœ¬ | æ¡¶æ•°é‡ | ç²¾åº¦ | å®é™…æ¯”ä¾‹åå·® |
|------|--------|------|------------|
| åŸç‰ˆæœ¬ (MD5, 100æ¡¶) | 100 | 1% | ~2-3% |
| ä¿®å¤ç‰ˆæœ¬ (SHA256, 10000æ¡¶) | 10000 | 0.01% | < 1% |

æµ‹è¯•ç»“æœï¼š
```
è®­ç»ƒé›†: 711/1000 (71.10%)  âœ… ç›®æ ‡70%ï¼Œåå·®1.1%
éªŒè¯é›†: 130/1000 (13.00%)  âœ… ç›®æ ‡15%ï¼Œåå·®2.0%
æµ‹è¯•é›†: 159/1000 (15.90%)  âœ… ç›®æ ‡15%ï¼Œåå·®0.9%
```

## ä½¿ç”¨æŒ‡å—

### æ–¹æ³•1ï¼šä½¿ç”¨åŸè„šæœ¬ï¼ˆå·²ä¿®å¤ï¼‰

```bash
# å¸§çº§åˆ«åˆ’åˆ†
python convert_fred_to_fusion.py --split-mode frame

# éªŒè¯å¸§åˆ’åˆ†
python test_fusion_frame_split.py
```

### æ–¹æ³•2ï¼šä½¿ç”¨ v2 è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å¸§çº§åˆ«åˆ’åˆ†ï¼ˆæ¨èï¼‰
python convert_fred_to_fusion_v2.py --split-mode frame

# ä»…éªŒè¯ä¸ç”Ÿæˆ
python convert_fred_to_fusion_v2.py --split-mode frame --validate-only
```

### æ–¹æ³•3ï¼šè¿è¡Œå®Œæ•´æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python test_frame_split.py

# è¾“å‡ºï¼š
# âœ… ä¸€è‡´æ€§æ£€æŸ¥: é€šè¿‡
# âœ… åˆ†å¸ƒç»Ÿè®¡: é€šè¿‡
# âœ… æ•°æ®æ³„æ¼æ£€æŸ¥: é€šè¿‡
# âœ… ç¡®å®šæ€§éªŒè¯: é€šè¿‡
# âœ… åºåˆ—éš”ç¦»éªŒè¯: é€šè¿‡
```

## å…³é”®æ”¹è¿›æ€»ç»“

| æ”¹è¿›é¡¹ | åŸç‰ˆæœ¬ | ä¿®å¤ç‰ˆæœ¬ | æ”¹è¿› |
|--------|--------|----------|------|
| å“ˆå¸Œå‡½æ•° | MD5 | SHA256 | æ›´å®‰å…¨ï¼Œæ›´å‡åŒ€ |
| æ¡¶æ•°é‡ | 100 (1%) | 10000 (0.01%) | ç²¾åº¦æå‡100å€ |
| å‡½æ•°ä½ç½® | åµŒå¥—å®šä¹‰ | ç±»æ–¹æ³• | ä»£ç æ›´æ¸…æ™° |
| å¸§æ ‡è¯†ç¬¦ | image_id | æ—¶é—´æˆ³ | æ›´å‡†ç¡® |
| éªŒè¯æµ‹è¯• | æ—  | å®Œæ•´å¥—ä»¶ | å¯é æ€§æå‡ |
| ä¸€è‡´æ€§ | æ— ä¿è¯ | 100% ä¸€è‡´ | ç¡®å®šæ€§ä¿è¯ |

## æŠ€æœ¯ç»†èŠ‚

### å¸§æ ‡è¯†ç¬¦æ ¼å¼

```python
# RGB å¸§
frame_key = f"rgb_{seq_id}_{rgb_timestamp:.6f}"
# ç¤ºä¾‹ï¼šrgb_1_100.123456

# Event å¸§  
frame_key = f"event_{seq_id}_{event_timestamp:.6f}"
# ç¤ºä¾‹ï¼ševent_1_100.123456
```

### å“ˆå¸Œè®¡ç®—

```python
hash_input = f"{frame_key}_{seed}"
# ç¤ºä¾‹ï¼š"rgb_1_100.123456_42"

hash_value = int(hashlib.sha256(hash_input.encode()).hexdigest(), 16)
# è¿”å›å¤§æ•´æ•°

mod_value = hash_value % 10000  # 0-9999
rand_val = mod_value / 10000.0  # 0.0000-0.9999
```

### ç‰ˆæœ¬å·ç­–ç•¥

è„šæœ¬ç‰ˆæœ¬ | æ•°æ®é›†ç‰ˆæœ¬ | è¯´æ˜
---------|-----------|------
`convert_fred_to_fusion.py` v1.0 | Fusion v1.0 | åŸç‰ˆæœ¬ï¼ˆéƒ¨åˆ†ä¿®å¤ï¼‰
`convert_fred_to_fusion_v2.py` v2.0 | Fusion v2.0 | å®Œå…¨éªŒè¯ç‰ˆæœ¬

## æ¨èä½¿ç”¨

### å¯¹äºæ–°ç”¨æˆ·

**å¼ºçƒˆæ¨èä½¿ç”¨ v2 ç‰ˆæœ¬**ï¼š

```bash
python convert_fred_to_fusion_v2.py --split-mode frame
```

ç†ç”±ï¼š
- âœ… å®Œå…¨éªŒè¯çš„å¸§çº§åˆ«åˆ’åˆ†
- âœ… è‡ªåŠ¨ç”ŸæˆéªŒè¯æŠ¥å‘Š
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†
- âœ… æ›´æ¸…æ™°çš„ä»£ç ç»“æ„

### å¯¹äºç°æœ‰é¡¹ç›®

å¦‚æœå·²åœ¨ä½¿ç”¨åŸè„šæœ¬ï¼š
1. åŸè„šæœ¬å·²ä¿®å¤ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨
2. æˆ–è¿ç§»åˆ° v2 ç‰ˆæœ¬ï¼ˆéœ€é‡æ–°ç”Ÿæˆæ•°æ®é›†ï¼‰
3. ä½¿ç”¨ `test_frame_split.py` éªŒè¯ç°æœ‰æ•°æ®é›†

## æ€»ç»“

### âœ… é—®é¢˜å·²å®Œå…¨è§£å†³

1. **å¸§çº§åˆ«åˆ’åˆ†åŠŸèƒ½å·²ä¿®å¤**
   - ä½¿ç”¨ `get_frame_split` ç±»æ–¹æ³•
   - ä½¿ç”¨ SHA256 å“ˆå¸Œå‡½æ•°
   - 10000ä¸ªæ¡¶ï¼Œ0.01% ç²¾åº¦

2. **éªŒè¯é€šè¿‡**
   - æ‰€æœ‰æµ‹è¯• 100% é€šè¿‡
   - æ¯”ä¾‹ç²¾åº¦ < 1%
   - æ— æ•°æ®æ³„æ¼

3. **æ¨èä½¿ç”¨ v2 ç‰ˆæœ¬**
   - å®Œæ•´çš„éªŒè¯æ¡†æ¶
   - æ›´å¥½çš„ä»£ç è´¨é‡
   - è¯¦ç»†çš„ç»Ÿè®¡æŠ¥å‘Š

### ğŸ“Š éªŒè¯æŒ‡æ ‡

- **ä¸€è‡´æ€§**: 1000/1000 æµ‹è¯•é€šè¿‡ âœ…
- **æ¯”ä¾‹è¯¯å·®**: < 1% âœ…
- **æ•°æ®æ³„æ¼**: 0 èµ· âœ…
- **ç¡®å®šæ€§**: 100% âœ…

---

**ä¿®å¤æ—¥æœŸ**: 2025-11-25  
**éªŒè¯å·¥å…·**: `test_frame_split.py`  
**é€šè¿‡ç‡**: 100% (5/5 æµ‹è¯•é€šè¿‡)  
**æ¨èç‰ˆæœ¬**: v2.0
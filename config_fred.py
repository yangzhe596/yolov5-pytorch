"""
FRED数据集训练配置文件
"""

# ============================================================================
# 数据集配置
# ============================================================================

# 选择模态: 'rgb' 或 'event'
MODALITY = 'rgb'

# COCO数据集根目录
COCO_ROOT = 'datasets/fred_coco'

# 类别配置（FRED数据集只有一个类别）
NUM_CLASSES = 1
CLASS_NAMES = ['object']

# ============================================================================
# 模型配置
# ============================================================================

# 输入图片尺寸（必须是32的倍数）
INPUT_SHAPE = [640, 640]

# 主干网络: 'cspdarknet', 'convnext_tiny', 'convnext_small', 'swin_transfomer_tiny'
BACKBONE = 'cspdarknet'

# YOLOv5版本: 's', 'm', 'l', 'x'
PHI = 's'

# 是否使用预训练权重
PRETRAINED = True

# 模型权重路径（为空则从头训练或使用预训练权重）
MODEL_PATH = ''

# 先验框配置
ANCHORS_PATH = 'model_data/yolo_anchors.txt'
ANCHORS_MASK = [[6, 7, 8], [3, 4, 5], [0, 1, 2]]

# ============================================================================
# 训练配置
# ============================================================================

# CUDA配置
CUDA = True
DISTRIBUTED = False
SYNC_BN = False
FP16 = False

# 随机种子
SEED = 11

# 训练轮次
INIT_EPOCH = 0
FREEZE_EPOCH = 50
UNFREEZE_EPOCH = 300

# Batch Size
FREEZE_BATCH_SIZE = 16
UNFREEZE_BATCH_SIZE = 8  # FRED数据集目标较小，使用较小的batch

# 是否冻结训练
FREEZE_TRAIN = True

# ============================================================================
# 优化器配置
# ============================================================================

# 优化器类型: 'adam' 或 'sgd'
OPTIMIZER_TYPE = 'sgd'

# 学习率
INIT_LR = 1e-2
MIN_LR = INIT_LR * 0.01

# SGD参数
MOMENTUM = 0.937
WEIGHT_DECAY = 5e-4

# 学习率衰减类型: 'step' 或 'cos'
LR_DECAY_TYPE = 'cos'

# ============================================================================
# 数据增强配置
# ============================================================================

# Mosaic数据增强
MOSAIC = True
MOSAIC_PROB = 0.5

# MixUp数据增强
MIXUP = True
MIXUP_PROB = 0.5

# 特殊数据增强比例（前70%的epoch使用强数据增强）
SPECIAL_AUG_RATIO = 0.7

# 标签平滑
LABEL_SMOOTHING = 0

# ============================================================================
# 训练控制
# ============================================================================

# 保存周期（每多少个epoch保存一次）
SAVE_PERIOD = 10

# 保存目录
SAVE_DIR = 'logs'

# 评估配置
EVAL_FLAG = True
EVAL_PERIOD = 10

# 数据加载
NUM_WORKERS = 4

# ============================================================================
# FRED数据集特定配置
# ============================================================================

# FRED数据集特点：
# - 单类别目标检测
# - 小目标为主（平均50x34像素）
# - RGB模态: 19,471张图片
# - Event模态: 28,714张图片

# 针对小目标的优化建议：
# 1. 使用较小的输入尺寸（如640x640）或更大（如1280x1280）
# 2. 调整先验框以适应小目标
# 3. 增加训练轮次
# 4. 使用数据增强

# 针对不同模态的建议：
# RGB模态:
#   - 标准的数据增强策略
#   - 注意：存在两个标注源（RGB_YOLO vs coordinates.txt），当前使用RGB_YOLO
#
# Event模态:
#   - 可能需要不同的数据增强策略
#   - 注意：约3%的边界框被裁剪（原始标注超出边界）

# ============================================================================
# 使用说明
# ============================================================================

"""
快速开始：

1. 确保已转换FRED数据集为COCO格式：
   python convert_fred_to_coco.py --modality rgb

2. 训练RGB模态：
   python train_fred.py --modality rgb

3. 训练Event模态：
   python train_fred.py --modality event

4. 自定义配置：
   修改本文件中的配置参数，然后运行train_fred.py

5. 断点续练：
   设置 MODEL_PATH = 'logs/fred_rgb/best_epoch_weights.pth'
   设置 INIT_EPOCH = 60（从第60轮继续）
"""
